<ion-menu [type]="'overlay'" content-id="main-content">
  <ion-content class="ion-padding">
    <app-current-play-list
      #playlistObject
      [playlist]="playBackFacade.playlist().items"
      [currentTrackPosition]="playBackFacade.playerState()?.position ?? null"
      (playlistChanged)="onPlaylistChanged()"
    />
  </ion-content>
</ion-menu>

<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <img class="app-logo" [src]="themeService.themeImage()" alt="ReaKtive" />
    </ion-buttons>
    @if (globalSearch.isSearchVisible()) {
      <ion-searchbar
        [value]="globalSearch.searchTerm()"
        (ionInput)="onSearch($event)"
        placeholder="Buscar..."
        [debounce]="0"
      />
    }
    <ion-buttons slot="end">
      <ion-button
        size="small"
        fill="clear"
        color="dark"
        (click)="navigateTo('music')"
      >
        <ion-icon slot="icon-only" ios="musical-notes" md="musical-notes" />
      </ion-button>
      <ion-button
        size="small"
        fill="clear"
        color="dark"
        (click)="navigateTo('video')"
      >
        <ion-icon slot="icon-only" ios="tv" md="tv" />
      </ion-button>
      <ion-button
        size="small"
        fill="clear"
        color="dark"
        (click)="navigateTo('remote')"
      >
        <ion-icon
          slot="icon-only"
          ios="game-controller-outline"
          md="game-controller-outline"
        />
      </ion-button>
      <ion-button
        size="small"
        fill="clear"
        color="dark"
        (click)="navigateTo('playlists')"
      >
        <ion-icon slot="icon-only" ios="list-outline" md="list-outline" />
      </ion-button>
      <ion-button
        size="small"
        fill="clear"
        color="dark"
        (click)="themeService.toggleTheme()"
      >
        <ion-icon
          slot="icon-only"
          [ios]="themeService.themeIcon()"
          [md]="themeService.themeIcon()"
        />
      </ion-button>
      <ion-button size="small" fill="clear" color="dark">
        <ion-icon slot="icon-only" ios="settings-sharp" md="settings-sharp" />
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content id="main-content" class="ion-padding">
  <div class="canvas-player" [class.canvas-player--no-bar]="isRemoteActive()">
    <div class="flex-div">
      <ion-router-outlet />
    </div>

    @if (!isRemoteActive()) {
      <div class="control-nav">
        <div
          class="control-nav__bg"
          [style.background-image]="
            controlBgUrl() ? 'url(' + controlBgUrl() + ')' : 'none'
          "
        ></div>
        <div class="control-nav__overlay"></div>
        <!-- Sección 1: Track Info -->
        <div class="control-nav__info">
          <player-current-track [currentTrack]="playBackFacade.playerInfo()" />
        </div>

        <!-- Sección 2: Playback Controls + Seekbar -->
        <div class="control-nav__playback">
          <app-player-control class="player-control" />
        </div>

        <!-- Sección 3: Extras (party, playlist, volume) -->
        <div class="control-nav__extras">
          <ion-button
            size="small"
            fill="clear"
            (click)="playBackFacade.togglePartyMode()"
            [color]="
              playBackFacade.playerState()?.partyMode ? 'primary' : 'dark'
            "
          >
            <ion-icon slot="icon-only" name="beer-outline" />
          </ion-button>
          <ion-menu-toggle>
            <ion-button size="small" fill="clear" color="dark">
              <ion-icon
                slot="icon-only"
                ios="reorder-three-outline"
                md="reorder-three-outline"
              />
            </ion-button>
          </ion-menu-toggle>
          <app-sound
            [volume]="playBackFacade.volume()"
            [isMute]="playBackFacade.isMute()"
            (volumeChange)="updateVolume($event)"
          />
        </div>
      </div>
    }
  </div>
</ion-content>
